<!DOCTYPE html>
<html>
<head>
    <title>Analysis Results - Fruit Label Placement</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1, h2 { color: #2c3e50; }
        .summary { background: #ecf0f1; padding: 20px; border-radius: 5px; margin: 20px 0; }
        .visualizations { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .viz-card { border: 1px solid #ddd; border-radius: 5px; overflow: hidden; }
        .viz-card img { width: 100%; height: auto; }
        .viz-card h3 { margin: 0; padding: 10px; background: #34495e; color: white; font-size: 14px; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin: 5px; cursor: pointer; }
        button:hover { background: #2980b9; }
        .back-btn { background: #95a5a6; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
        th { background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Analysis Results</h1>
        
        <button onclick="location.href='/'" class="back-btn">â† Back to Main</button>
        <button onclick="location.href='/download/results.json'">ğŸ’¾ Download JSON</button>
        <button onclick="location.href='/download/results.csv'">ğŸ“Š Download CSV</button>
        
        <div class="summary">
            <h2>Summary</h2>
            {% if results.processing_summary %}
            <p><strong>Images processed:</strong> {{ results.processing_summary.successful_images }}/{{ results.processing_summary.total_images }}</p>
            <p><strong>Fruits detected:</strong> {{ results.processing_summary.total_fruits }}</p>
            <p><strong>Label candidates found:</strong> {{ results.processing_summary.total_candidates }}</p>
            {% endif %}
        </div>
        
        <h2>ğŸ–¼ï¸ Visualizations</h2>
        <div class="visualizations">
            {% for viz in visualizations %}
            <div class="viz-card">
                <h3>{{ viz }}</h3>
                <img src="/download/{{ viz }}" alt="{{ viz }}">
                <div style="padding: 10px;">
                    <button onclick="window.open('/download/{{ viz }}')">ğŸ” View Full Size</button>
                    <button onclick="location.href='/download/{{ viz }}'">ğŸ’¾ Download</button>
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% if results.results %}
        <h2>ğŸ“‹ Detailed Results</h2>
        {% for result in results.results %}
        <h3>Image: {{ result.image_name }}</h3>
        <p><strong>Processing time:</strong> {{ "%.2f"|format(result.processing_time) }} seconds</p>
        <p><strong>Fruits found:</strong> {{ result.num_fruits }}</p>
        
        {% for fruit in result.fruits %}
        <h4>Fruit {{ fruit.fruit_id }}</h4>
        <table>
            <tr><th>Property</th><th>Value</th></tr>
            <tr><td>Area</td><td>{{ fruit.properties.area }} pixels</td></tr>
            <tr><td>Mean Depth</td><td>{{ "%.3f"|format(fruit.properties.mean_depth) }} meters</td></tr>
            <tr><td>Circularity</td><td>{{ "%.3f"|format(fruit.properties.circularity) }}</td></tr>
            <tr><td>Flat Surface %</td><td>{{ "%.1f"|format(fruit.planarity_statistics.flat_percentage) }}%</td></tr>
            <tr><td>Candidates Found</td><td>{{ fruit.num_candidates }}</td></tr>
        </table>
        {% endfor %}
        {% endfor %}
        {% endif %}
    </div>
</body>
</html>